<!-- NGX MAT DATETIME PICKER -->
<div *ngIf="type == 1 && !formGroupInput">
  <mat-form-field class="custom-ngx-datetime" appearance="outline">
    <mat-label>{{ placeholder }}</mat-label>
    <input
      #dateTime
      (keyup.enter)="dateTime.blur()"
      matInput
      [ngxMatDatetimePicker]="DateTimePicker"
      [(ngModel)]="dateTimeInput"
      (dateChange)="onInputDateChange($event)"
      [min]="minDate"
      [max]="maxDate"
      [placeholder]="placeholder"
      [disabled]="disabled"
      [readonly]="readonlyInput"
      [required]="isRequired" />
    <mat-datepicker-toggle class="toggle-button" matIconSuffix [for]="$any(DateTimePicker)"></mat-datepicker-toggle>
    <ngx-mat-datetime-picker
      class="ngx-datetime"
      #DateTimePicker
      [showSpinners]="showSpinners"
      [showSeconds]="showSeconds"
      [disabled]="disabled"
      [disableMinute]="disableMinute"
      [stepHour]="stepHour"
      [stepMinute]="stepMinute"
      [stepSecond]="stepSecond"
      [color]="color"
      [enableMeridian]="enableMeridian"
      [touchUi]="touchUi">
      <ngx-mat-datepicker-actions *ngIf="showButtons">
        <button mat-button ngxMatDatepickerCancel (click)="clearNgModel()">
          {{ cancelButtonText }}
        </button>
        <button mat-raised-button [color]="color" ngxMatDatepickerApply>
          {{ applyButtonText }}
        </button>
      </ngx-mat-datepicker-actions>
    </ngx-mat-datetime-picker>
  </mat-form-field>
</div>
<!-- NGX MAT DATETIME PICKER (FORM CONTROL) -->
<div *ngIf="type == 1 && formGroupInput">
  <form [formGroup]="formGroupInput">
    <mat-form-field class="custom-ngx-datetime" appearance="outline">
      <mat-label>{{ placeholder }}</mat-label>
      <input
        #dateTime
        (keyup.enter)="dateTime.blur()"
        matInput
        (dateChange)="onInputDateChange($event)"
        [ngxMatDatetimePicker]="DateTimePicker"
        [min]="minDate"
        [max]="maxDate"
        [placeholder]="placeholder"
        [disabled]="disabled"
        [readonly]="readonlyInput"
        [formControlName]="formControlNameInput"
        [required]="isRequired" />
      <mat-datepicker-toggle class="toggle-button" matIconSuffix [for]="$any(DateTimePicker)"></mat-datepicker-toggle>
      <ngx-mat-datetime-picker
        #DateTimePicker
        [showSpinners]="showSpinners"
        [showSeconds]="showSeconds"
        [disabled]="disabled"
        [disableMinute]="disableMinute"
        [stepHour]="stepHour"
        [stepMinute]="stepMinute"
        [stepSecond]="stepSecond"
        [color]="color"
        [enableMeridian]="enableMeridian"
        [touchUi]="touchUi">
        <ngx-mat-datepicker-actions *ngIf="showButtons">
          <button mat-button ngxMatDatepickerCancel (click)="clearControl()">
            {{ cancelButtonText }}
          </button>
          <button mat-raised-button [color]="color" ngxMatDatepickerApply>
            {{ applyButtonText }}
          </button>
        </ngx-mat-datepicker-actions>
      </ngx-mat-datetime-picker>
    </mat-form-field>
  </form>
</div>

<!-- MATERIAL DATE PICKER -->
<div *ngIf="type == 2 && !formGroupInput">
  <mat-form-field class="custom-mat-date" appearance="outline">
    <mat-label>{{ placeholder }}</mat-label>
    <input
      #date
      (keyup.enter)="date.blur()"
      matInput
      [matDatepickerFilter]="datepickerFilter"
      [matDatepicker]="DatePicker"
      [(ngModel)]="dateTimeInput"
      (dateChange)="onInputDateChange($event)"
      [min]="minDate"
      [max]="maxDate"
      [disabled]="disabled"
      [readonly]="readonlyInput"
      [required]="isRequired"
      [placeholder]="placeholder" />
    <mat-datepicker-toggle class="toggle-button" matIconSuffix [for]="DatePicker"></mat-datepicker-toggle>
    <mat-datepicker #DatePicker [disabled]="disabled" [color]="color" [touchUi]="touchUi">
      <mat-datepicker-actions *ngIf="showButtons">
        <button mat-button matDatepickerCancel (click)="clearNgModel()">
          {{ cancelButtonText }}
        </button>
        <button mat-raised-button [color]="color" matDatepickerApply>
          {{ applyButtonText }}
        </button>
      </mat-datepicker-actions>
    </mat-datepicker>
  </mat-form-field>
</div>
<!-- MATERIAL DATE PICKER (FORM CONTROL) -->
<div *ngIf="type == 2 && formGroupInput">
  <form [formGroup]="formGroupInput">
    <mat-form-field class="custom-mat-date" appearance="outline">
      <mat-label>{{ placeholder }}</mat-label>
      <input
        [matDatepickerFilter]="datepickerFilter"
        #date
        (keyup.enter)="date.blur()"
        matInput
        [matDatepicker]="DatePicker"
        [min]="minDate"
        [max]="maxDate"
        [disabled]="disabled"
        [readonly]="readonlyInput"
        (dateChange)="onInputDateChange($event)"
        [formControlName]="formControlNameInput"
        [required]="isRequired"
        [placeholder]="placeholder" />
      <mat-datepicker-toggle class="toggle-button" matIconSuffix [for]="DatePicker"></mat-datepicker-toggle>
      <mat-datepicker #DatePicker [disabled]="disabled" [color]="color" [touchUi]="touchUi">
        <mat-datepicker-actions *ngIf="showButtons">
          <button mat-button matDatepickerCancel (click)="clearControl()">
            {{ cancelButtonText }}
          </button>
          <button mat-raised-button [color]="color" matDatepickerApply>
            {{ applyButtonText }}
          </button>
        </mat-datepicker-actions>
      </mat-datepicker>
    </mat-form-field>
  </form>
</div>

<!-- MATERIAL DATE RANGE PICKER -->
<div *ngIf="type == 4 && !formGroupInput">
  <mat-form-field class="custom-mat-daterange" appearance="outline">
    <mat-label>{{ startPlaceholeder + "-" + endPlaceholeder }}</mat-label>
    <mat-date-range-input
      [dateFilter]="datepickerFilter"
      [rangePicker]="DateRangePicker"
      [min]="minDate"
      [max]="maxDate"
      [required]="isRequired">
      <input
        #start
        (keyup.enter)="start.blur()"
        matStartDate
        [(ngModel)]="range.from"
        (dateChange)="onInputDateChange($event)"
        [placeholder]="startPlaceholeder"
        [disabled]="disabled"
        [required]="isRequired"
        [readonly]="readonlyInput" />
      <input
        #end
        (keyup.enter)="end.blur()"
        matEndDate
        [(ngModel)]="range.to"
        (dateChange)="onInputDateChange($event)"
        [placeholder]="endPlaceholeder"
        [disabled]="disabled"
        [required]="isRequired"
        [readonly]="readonlyInput" />
    </mat-date-range-input>
    <mat-datepicker-toggle class="toggle-button" matIconSuffix [for]="DateRangePicker"></mat-datepicker-toggle>
    <mat-date-range-picker
      #DateRangePicker
      [color]="color"
      [calendarHeaderComponent]="showRangePreset ? EqpRangeHeaderComponent : null"
      [touchUi]="touchUi">
      <mat-datepicker-actions *ngIf="showButtons">
        <button mat-button matDatepickerCancel (click)="clearNgModel(true)">
          {{ cancelButtonText }}
        </button>
        <button mat-raised-button [color]="color" matDatepickerApply>
          {{ applyButtonText }}
        </button>
      </mat-datepicker-actions>
    </mat-date-range-picker>
  </mat-form-field>
</div>
<!-- MATERIAL DATE RANGE PICKER (FORM CONTROL) -->
<div *ngIf="type == 4 && formGroupInput">
  <mat-form-field class="custom-mat-daterange" appearance="outline">
    <mat-label>{{ startPlaceholeder + "-" + endPlaceholeder }}</mat-label>
    <mat-date-range-input
      [dateFilter]="datepickerFilter"
      [formGroup]="formGroupInput"
      [rangePicker]="DateRangePicker"
      [required]="isRequired"
      [min]="minDate"
      [max]="maxDate">
      <input
        #start
        (keyup.enter)="start.blur()"
        matStartDate
        (dateChange)="onInputDateChange($event, false, true)"
        [placeholder]="startPlaceholeder"
        [disabled]="disabled"
        [readonly]="readonlyInput"
        [formControlName]="formControlNameInputStart"
        [required]="isRequired" />
      <input
        #end
        (keyup.enter)="end.blur()"
        matEndDate
        (dateChange)="onInputDateChange($event, false, false)"
        [placeholder]="endPlaceholeder"
        [disabled]="disabled"
        [readonly]="readonlyInput"
        [formControlName]="formControlNameInputEnd"
        [required]="isRequired" />
    </mat-date-range-input>
    <mat-datepicker-toggle class="toggle-button" matIconSuffix [for]="DateRangePicker"></mat-datepicker-toggle>
    <mat-date-range-picker
      #DateRangePicker
      [color]="color"
      [calendarHeaderComponent]="showRangePreset ? EqpRangeHeaderComponent : null"
      [touchUi]="touchUi">
      <mat-datepicker-actions *ngIf="showButtons">
        <button mat-button matDatepickerCancel (click)="clearControl(true)">
          {{ cancelButtonText }}
        </button>
        <button mat-raised-button [color]="color" matDatepickerApply>
          {{ applyButtonText }}
        </button>
      </mat-datepicker-actions>
    </mat-date-range-picker>
  </mat-form-field>
</div>

<!-- NGB TIME PICKER -->
<div *ngIf="type == 3 && !formGroupInput" class="col-md-12 col-lg-12">
  <mat-form-field
    (click)="!disabled && showTimePopover ? p?.open() : null; !disabled ? manageTimePickerValidation() : null"
    class="custome-ngb-time"
    [ngClass]="{ 'mdc-text-field--invalid': timeValidatorClassName === 'ngb-error' }"
    appearance="outline">
    <mat-label>{{ placeholder }}</mat-label>
    <input
      style="display: flow-root"
      [ngModel]="timeIsString ? val : (val | date : timeFormat)"
      type="time"
      [step]="showSeconds ? 1 : null"
      matInput
      (ngModelChange)="showTimePopover ? (val = $event) : (val = $event); onTimeChange(null, $event)"
      [disabled]="disabled"
      [readonly]="showTimePopover"
      [required]="isRequired"
      [placeholder]="placeholder"
      placement="bottom" />
    <mat-icon
      [ngClass]="{ disable: disabled }"
      style="width: 24px; height: 24px; margin-right: -4px; color: #707070"
      (click)="stopProp($event); manageTimePickerValidation()"
      #p="ngbPopover"
      matIconSuffix
      autoClose="outside"
      [ngbPopover]="showTimePopover ? timePickerTemplate : null">
      access_time
    </mat-icon>
  </mat-form-field>

  <ng-template #timePickerTemplate style="background-color: white">
    <div style="flex-direction: column; display: flex; align-items: center">
      <ngb-timepicker
        [ngClass]="timeValidatorClassName"
        [ngModelOptions]="{ standalone: true }"
        [ngModel]="dateTimeInput"
        (ngModelChange)="onTimeChange($event)"
        (click)="stopProp($event)"
        [seconds]="showSeconds"
        [spinners]="showSpinners"
        [hourStep]="stepHour"
        [minuteStep]="stepMinute"
        [secondStep]="stepSecond"
        [meridian]="enableMeridian"
        [disabled]="disabled"
        [readonlyInputs]="readonlyInput"></ngb-timepicker>
      <div class="row mt-3" *ngIf="showButtons">
        <div class="col">
          <button
            [ngClass]="timeValidatorClassName"
            [disabled]="disabled"
            mat-button
            (click)="p.close(); onTimeChange(null); setTime(); stopProp($event)">
            {{ cancelButtonText }}
          </button>
        </div>
        <div class="col">
          <button
            [ngClass]="timeValidatorClassName"
            [disabled]="disabled"
            (click)="setTime(); p.close(); stopProp($event)"
            mat-raised-button
            [color]="color">
            {{ applyButtonText }}
          </button>
        </div>
      </div>
    </div>
  </ng-template>
</div>
<!-- NGB TIME PICKER (FORM CONTROL) -->
<div *ngIf="type == 3 && formGroupInput" class="col-md-12 col-lg-12">
  <form [formGroup]="formGroupInput">
    <mat-form-field
      (click)="
        !disabled && showTimePopover ? p?.open() : null;
        !disabled && showTimePopover ? manageTimePickerValidation() : null
      "
      class="custome-ngb-time"
      [ngClass]="{ 'mdc-text-field--invalid': timeValidatorClassName === 'ngb-error' }"
      appearance="outline">
      <mat-label>{{ placeholder }}</mat-label>
      <input
        [value]="
          timeIsString || !showTimePopover
            ? formGroupInput.get(formControlNameInput)?.value
            : (formGroupInput.get(formControlNameInput)?.valueChanges | async | date : timeFormat)
        "
        style="display: flow-root"
        matInput
        [readonly]="showTimePopover"
        type="time"
        [step]="showSeconds ? 1 : null"
        [disabled]="disabled"
        [formControlName]="formControlNameInput"
        [required]="isRequired"
        [placeholder]="placeholder"
        placement="bottom" />
      <mat-icon
        [ngClass]="{ disable: disabled }"
        style="width: 24px; height: 24px; margin-right: -4px"
        (click)="stopProp($event); manageTimePickerValidation()"
        #p="ngbPopover"
        matIconSuffix
        autoClose="outside"
        [ngbPopover]="showTimePopover ? timePickerTemplate : null">
        access_time
      </mat-icon>
    </mat-form-field>
  </form>
  <ng-template #timePickerTemplate>
    <div style="flex-direction: column; display: flex; align-items: center">
      <ngb-timepicker
        [ngClass]="timeValidatorClassName"
        [ngModelOptions]="{ standalone: true }"
        [ngModel]="dateTimeInput"
        (ngModelChange)="onTimeChange($event)"
        (click)="stopProp($event)"
        [seconds]="showSeconds"
        [spinners]="showSpinners"
        [hourStep]="stepHour"
        [minuteStep]="stepMinute"
        [secondStep]="stepSecond"
        [meridian]="enableMeridian"
        [disabled]="disabled"
        [readonlyInputs]="readonlyInput"></ngb-timepicker>
      <div class="row mt-3" *ngIf="showButtons">
        <div class="col">
          <button
            [ngClass]="timeValidatorClassName"
            [disabled]="disabled"
            mat-button
            (click)="p.close(); onTimeChange(null); setTime(); stopProp($event)">
            {{ cancelButtonText }}
          </button>
        </div>
        <div class="col">
          <button
            [ngClass]="timeValidatorClassName"
            [disabled]="disabled"
            (click)="setTime(); p.close(); stopProp($event)"
            mat-raised-button
            [color]="color">
            {{ applyButtonText }}
          </button>
        </div>
      </div>
    </div>
  </ng-template>
</div>
